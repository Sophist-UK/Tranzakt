# Product structure
Tranzakt is intended to be delivered in the following forms:
* `Tranzakt Developer` - the full Tranzakt environment, capable of developing and running
Tranzakt apps.
* `Tranzakt Runtime` - a runtime environment which can execute pre-developed Tranzakt apps
but does not have any ability to develop or modify those apps.
The intention here is to enable the metadata for an app developed with Tranzakt developer
to be exported from Tranzakt Developer and then imported into Tranzakt Runtime.
* `Tranzakt Compiler` - a possible future enhancement
allowing the metadata to be compiled into faster, native php code which
makes direct calls to Tranzakt Runtime.
This could either run through the command line,
or on a JIT basis by tracking changes to Metadata.
The functionality could either be integrated into Tranzakt Runtime,
or if revenue is needed to fund ongoing support and development,
then instead it could be sold as a chargeable additional package.

# Directory structure
The directory structure below has been defined to hold Tranzakt code
and perhaps some files generated by user developed Tranzakt apps -
though most of the apps will be held dynamically in Tranzakt metadata database tables
(unless we develop a compiler to compile Tranzakt apps to Laravel php code
that can be executed directly rather than run by the Tranzakt runtime interpreter).

This design separates Laravel and other external open source code from Tranzakt code and from user developed code.
Wherever possible standard Laravel directory names are used to aid familiarity
as defined [here](https://laravel.com/docs/9.x/structure).

The standard Laravel directory stucture will be extended (by additional root sub-directories)
to segregate files for ease of management:
* Tranzakt Runtime
* Tranzakt Developer
* User developed apps
* Tranzakt internal runtime files
* User developed apps runtime files

A decision on whether to have e.g.
* `apps/core`
* `tests/core`

or

* `core/apps`
* `core/tests`

has yet to be made and will likely depend on ease of implementation.

* `userapp` -
    Will hold static files relating to user developed Tranzakt apps
    including static Blade templates, media etc. with subdirectories for each user app.
    The reason this directory is not in `storage` is so that you can choose to treat it
    as a deployment directory or not (whereas `storage` is never deployed.
* `public` -
    the root webspace directory for the webserver - holds all publicly accessible static files
    separate from php files which for security reasons are not directly accessible from the webserver.
    As per Laravel SoP, the public directory will contain subdirectories for
    `js`, `css`, `media`, `uploads` etc. and these will contain symbolic links to other directories
    holding the static files.
* `storage` -
    In addition to normal `app`, `framework` and `logs` directories this will have
    the following subdirectories:
    * `tranzakt_runtime`
    * `tranzakt_dev`
    * `userapp` containing files related to user developed Tranzakt apps.

    We will try to redirect `app`, `framework` and `log` files to subdirectories
    of the above directories however standard `app`, `framework` and `log` directories
    will remain to catch any laravel files not redirected.

# Design principles
* Asynchronous initiation of API responses for later retrieval
* Parallelism and Asynchronous execution of i/o
* Loosely coupled architecture - use of server events and both server and browser listeners
to break transactions into smaller pieces
* Design by Contract to ensure interfaces are called correctly (using php-deal?)
* PHP Unit testing using phpunit
* Regression testing to ensure end-user experience using Laravel Dusk
* Defaults hierarchy to avoid having to set e.g. security on every e.g. element
* Element constraint / validation hierarchy - specify constraints and validations at table, element or form level.
* Settings for logging Tranzakt activities to JS console during development either globally
or for specific activities.
* Analytics for development / production (using Laravel Telescope)
* Runtime security
* Admin/dev security (using Laravel Sanctum?)
* Queue management (if we ever implement batch queuing) using Laravel Horizon
* Support for SQL Transactions - all or nothing changes on submitting a form.
* Support for proper foreign-key relationships in SQL.

# Laravel Research Results
* Laravel Scout for search
* Vite (bundled with Laravel 8) for bundling JS files to reduce number of downloads
* Mews HTMLPurifier for Laravel https://github.com/mewebstudio/Purifier to avoid XSS
* Laravel Sanctum (SPA / API authentication - for Admin pages which will be SPA)
* Mateus Junges' Laravel-ACL for User groups
* Spatie Laravel-Permission - roles/permissions by Model (database)?
* Laravel UI (Vue scaffolding)
* The Control Group's Voyager - Admin feature set which includes:
    * settings management
    * BREAD (CRUD) operations
    * a media manager
    * menu builder
    * table management

Note: Need to choose between installed security frameworks or something else.

# Other resources
This is simply a list of resources that could be useful.
Please feel free to add to the list when you find anything useful,
and remove from the list once a Tranzakt component has been created using it or equivalent.

* vertabelo.com Physical Data Model for inspiration on table editor
* Devdojo's Wave to pick and choose functionality for:
    * Authentication - Fully loaded authentication, email verification, and password reset.
    * User Profiles - Easily Customizable User Profiles.
    * User Impersonation - Login as another user to resolve an issue/bug.
    * Billing - Allow users to pay for your service.
    * Subscription Plans - Subscription plans with different features.
    * User Roles - Assign a role and permissions to a specific plan.
    * Notifications - Ready-to-use Notification System.
    * Announcements - Notify users about new features or updates.
    * Blog - Equipped with a fully-functional blog.
    * API - Ready-to-consume API for your application
    * Themes - Fully configurable themes.
    * Voyager integration

    **Note:** We cannot use Wave out of the box because it is not updated frequently enough, is back level.
    But we can use it as inspiration.

* Jetstream - Fast start Login pages etc.
* Sentry - A way of getting end-to-end exception reporting. Open Source free usage has been requested.

* Spatie Laravel-backup - integrate automated backups into Tranzakt.
* Spatie Laravel-medialibrary - integrate media file uploads / thumbnail gen etc.
* Spatie Browsershot - possible use for creating screenshots for documentation and / or PDF's like Fabrik
* Spatie Laravel Activity Log - programmable logging to a database table

For specialised Tranzakt components:
* Cashier - Stripe payment processing interface
* Koel - music streaming
* Flarum - forum software for standalone functionality
* October CMS - standalone functionality
* Laravel Stats Tracker
* Laravel tags
* Bookstack - Wiki software

Other security:
* Laratrust / Defender (very similar models) - roles / permissions by user

Other admin panels:
* Orchid

# Design questions
We need to decide:
* Do we need a (Component based) plugin architecture like Fabrik's to keep both disk space and attack surface down
or can we simply have an enable/disable setting?